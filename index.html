<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>awm&#39;s blog &middot; awm&#39;s blog</title>

    <meta name="description" content="What did I do today?">

    <meta name="generator" content="Hugo 0.15" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="awm&#39;s blog &middot; awm&#39;s blog">
    <meta name="twitter:description" content="What did I do today?">

    <meta property="og:type" content="article">
    <meta property="og:title" content="awm&#39;s blog &middot; awm&#39;s blog">
    <meta property="og:description" content="What did I do today?">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="https://ders.github.io/css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://ders.github.io/css/vim.css">

    <link rel="alternate" type="application/rss+xml" title="awm&#39;s blog" href="https://ders.github.io/index.xml" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://ders.github.io">awm&#39;s blog</a></h1>
            <h2 class="brand-tagline"> What did I do today? </h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://ders.github.io/index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>
    </div>
</div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                
                <h1 class="content-subhead">08 Jan 2016, 15:50</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2016-01-08-google-signin/" class="post-title">Google Sign-in</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        

<h2 id="using-google-sign-in-on-website-x:a9bc523f98a05ffe7a400551ba7208e4">Using Google Sign-in on Website X</h2>

<p><strong>Disclaimer:</strong>  <a href="https://developers.google.com/identity/sign-in/web/sign-in">Read the docs</a> too.  This post doesn&rsquo;t cover everything.</p>

<p>A week ago I was completely clueless as to how Google sign-in works.  I set out to write about it and learned a few things.</p>

<h3 id="overview:a9bc523f98a05ffe7a400551ba7208e4">Overview</h3>

<p>Using Google sign-in on a website requires first doing the following in the <a href="https://console.developers.google.com/home/dashboard">Google developer&rsquo;s console</a>:</p>

<ul>
<li>creating a project</li>
<li>creating a sign-in client ID for that project</li>
<li>associating the domain(s) of the website with the sign-in client ID</li>
</ul>

<p>Sign-in is done using javascript on the web page to talk directly to Google&rsquo;s servers.  The javascript is loaded from Google&rsquo;s servers.  It is not necessary to involve the server for website X at all.</p>

<p>When Joe the Hacker attempts to sign in to website X, a popup dialog appears.  The contents of the dialog depend on Joe&rsquo;s current signed-in state.</p>

<p>If Joe is not signed in to Google at all, then a sign-in dialog appears.  If he&rsquo;s signed in to more than one account, then an account chooser dialog appears.  If he&rsquo;s signed into exactly one account, then the sign-in part is skipped.</p>

<p>If this is the first time he&rsquo;s attempted to sign in to website X, then he&rsquo;ll be asked to give permission for website X to have access to his profile information (name, picture) and email address.</p>

<p>In the case that Joe needs neither the sign-in dialog nor the permissions dialog (i.e. he&rsquo;s already signed in to exactly one account and is a returning user), then the pop-up closes itself immediately without any user action.</p>

<p>The browser remembers that Joe is signed in to website X using Google sign-in.  He can sign out of website X and still be signed into Google.  However, if he signs out of Google, then he&rsquo;ll automatically be signed out of website X as well.  He can&rsquo;t be signed in to website X using his Google ID and not also be signed in to Google.</p>

<p>If the webpage making the sign-in call is served from a domain that has not been registered in the console, then Joe will see a 400 error (redirect_uri_mismatch) and a picture of a broken robot when trying to sign in.  The error page also exposes the email address of the account that the project is made under.</p>

<h3 id="javascript-details:a9bc523f98a05ffe7a400551ba7208e4">Javascript details</h3>

<p>The file platform.js provides the global Google API object called <code>gapi</code> and the auth2 module.  The auth2 module must be explicitly loaded into gapi with the <code>gapi.load</code> method before it&rsquo;s used.  This method provides an optional callback for when/if the module is loaded successfully.</p>

<pre><code>gapi.load(&quot;auth2&quot;, callback);
</code></pre>

<p>Once the module is loaded, it must be initialized with the sign-in client ID (see above).  The client ID may either be provided as <a href="https://developers.google.com/identity/sign-in/web/reference#gapiauth2initwzxhzdk20paramswzxhzdk21">an option to the init method</a> or in <a href="https://developers.google.com/identity/sign-in/web/sign-in#specify_your_apps_client_id">a meta tag in the document</a>.  The init function returns a GoogleAuth object.</p>

<pre><code>gauth = gapi.auth2.init(options);
</code></pre>

<p>A logical initialization flow would be to have the initialization in the load callback.</p>

<pre><code>gapi.load(&quot;auth2&quot;, function() { gapi.auth2.init(); });
</code></pre>

<p>The GoogleAuth object may also be obtained any time after it&rsquo;s initialized using the <a href="https://developers.google.com/identity/sign-in/web/reference#gapiauth2getauthinstance"><code>getAuthInstance</code></a> method.</p>

<pre><code>gauth = gapi.auth2.getAuthInstance();
</code></pre>

<p>At this point we can find out whether Joe is or isn&rsquo;t signed in to website X.</p>

<pre><code>if (gauth.isSignedIn.get()) { alert(&quot;User is signed in, and I debug with alerts.&quot;); }
</code></pre>

<p>If he isn&rsquo;t signed in, we can try to sign him in.  This is done with <code>GoogleAuth.signIn</code>.  In most cases, we should wait for him to click a button (e.g. &ldquo;Sign In with Google&rdquo;) before doing so.  There are <a href="https://developers.google.com/identity/sign-in/web/reference#googleauthsigninwzxhzdk72optionswzxhzdk73">a few options</a> that we can ignore for now.</p>

<pre><code>gauth.SignIn(options)
</code></pre>

<p>This function returns <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">a Promise</a>, making it easy to do stuff when it finishes.</p>

<pre><code>gauth.SignIn().then(function() {
    alert(&quot;We're in!&quot;);
}, function() {
    alert(&quot;You FAILED!&quot;);
});
</code></pre>

<p>There is also this thing called a GoogleUser object, which we can get after Joe has signed in.  (We can also get it before he&rsquo;s signed in, but it would be useless.)  The GoogleUser object reveals Joe&rsquo;s name, email address and profile picture if he has one.</p>

<pre><code>user = gauth.currentUser.get();
profile = user.getBasicProfile();
alert(profile.getName() + &quot; &quot; + profile.getEmail());
</code></pre>

<p>Finally, use can use <code>GoogleAuth.signOut</code> to sign Joe out of website X.</p>

<pre><code>gauth.signOut();
</code></pre>

<p>Although this signs him out, it doesn&rsquo;t forget about him.  The GoogleUser object is still available and still has his ID.</p>

<pre><code>user = gauth.currentUser.get();
alert(user.getId());
alert(user.isSignedIn());    // false
</code></pre>

<p>And we can sign him in again using the grant method.  This behaves slightly differently from <code>GoogleAuth.signIn</code> in that it doesn&rsquo;t give Joe a chance to choose a different account.</p>

<pre><code>user.grant();
</code></pre>

<p>According to the documentation, <code>GoogleUser.signIn</code> is equivalent to <code>GoogleUser.grant</code>, but my Firebug tells me that there&rsquo;s in fact no method called signIn on the GoogleUser object.  Bad documentation.</p>

<h3 id="what-usually-happens-in-practice:a9bc523f98a05ffe7a400551ba7208e4">What usually happens in practice</h3>

<p>Google provides <a href="https://developers.google.com/identity/sign-in/web/sign-in#add_a_google_sign-in_button">a handy shortcut</a> so that anyone can add Google sign-in to their page without knowing any javascript.  As soon as platform.js is loaded, it checks for the existence of a <code>div.g-signin2</code> (&lt;div class=&ldquo;g-signin2&rdquo;&gt;) and springs into action if found.</p>

<p>It loads the auth2 module and puts a standard sign-in button in the div (clobbering what was there, watch out), and wires up the button so that when you press it, it logs you in.  It can also call a function of your choosing on sign-in, passing in Joe&rsquo;s GoogleUser object.</p>

<p>The button appears to be rendered with <a href="https://developers.google.com/identity/sign-in/web/reference#gapisignin2renderwzxhzdk114idwzxhzdk115_wzxhzdk116optionswzxhzdk117"><code>gapi.signin2.render</code></a>, and specifying options like this works as expected:</p>

<pre><code>&lt;div class=&quot;g-signin2&quot; data-onsuccess=&quot;onSignIn&quot; data-longtitle=&quot;true&quot; data-width=&quot;200&quot;&gt;&lt;/div&gt;
</code></pre>

<p>One caution here is that data-longtitle is a string value that gets cast to a boolean, and, as such, the string &ldquo;false&rdquo; will get cast to true.  The way to make longtitle false is set data-longtitle=&quot;&quot; (or to omit it entirely, as false is the default).</p>

<h3 id="involving-the-server-for-website-x:a9bc523f98a05ffe7a400551ba7208e4">Involving the server for website X</h3>

<p>Chances are website X will want to know about Joe&rsquo;s sign-in on the server side.  This will require some javascript to send a token to the server, which the server can then decode to get Joe&rsquo;s information.</p>

<p>The token can be obtained from the GoogleUser object.</p>

<pre><code>token = user.getAuthResponse().id_token
</code></pre>

<p>The token is signed to prevent spoofing, and it&rsquo;s up to the server code to <a href="https://developers.google.com/identity/sign-in/web/backend-auth#verify-the-integrity-of-the-id-token">verify its integrity</a>.</p>

<h3 id="scopes:a9bc523f98a05ffe7a400551ba7208e4">Scopes</h3>

<p>Scopes are the permissions that we&rsquo;re asking Joe to give to website X.  The default for sign-in is scopes profile and email, and we get Joe&rsquo;s name, email, and picture if available.  <em>(Nerdy detail: the name and picture are not part of any scope; see below.)</em></p>

<p>With the default settings, Joe will see the a request for the following permissions the first time he attempts to sign in to website X:</p>

<ol>
<li>Know who you are on Google</li>
<li>View your email address</li>
<li>View your basic profile info</li>
</ol>

<p>If other permissions (e.g. calendar) are needed, they can be added with the <code>scope</code> option in GoogleAuth.init, the <code>scope</code> option in GoogleAuth.signIn, or the <code>data-scope</code> tag on div.g-signin2.  Most scopes are expressed as urls, e.g. &quot;https:&#47;&#47;www.googleapis.com/auth/calendar.readonly&rdquo;.</p>

<p>Here is <a href="https://developers.google.com/identity/protocols/googlescopes">a list of all known scopes</a>.</p>

<h3 id="fewer-scopes:a9bc523f98a05ffe7a400551ba7208e4">Fewer Scopes</h3>

<p>The default scopes can be turned off with by sending <code>fetch_basic_profile: false</code> as one of the options to GoogleAuth.init.  (Note that this precludes using the auto magic button.)  In this case, at least one scope must be explicitly specified with the scope parameter.</p>

<p>The two scopes that are included by default are <code>profile</code> and <code>email</code>.  Adding the <code>profile</code> scope does nothing.  It only provides Joe&rsquo;s 21-digit ID, which we get anyway.  Adding the <code>email</code> scope gives us Joe&rsquo;s email address, but the only way to get it is to decode <code>id_token</code>, as <code>GoogleUser.getBasicProfile</code> only works when <code>fetch_basic_profile</code> is true.</p>

<p>Strangely, requesting only the <code>email</code> scope causes permission requests #1 and #2 to be displayed, even though we only get the email access.  Requesting only the <code>profile</code> scope causes only #3 to be displayed.  Requesting both <code>email</code> and <code>profile</code> displays #2 and #3 but not #1.  I have yet to understand the logic behind this behavior.</p>

<p>Also strange is the fact that neither the <code>profile</code> nor <code>email</code> scope provides Joe&rsquo;s name and picture.  As far as I can tell, the only way to get his name and picture is to stick to the default <code>fetch_basic_profile: true</code>.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">05 Jan 2016, 11:45</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2016-01-05-happy-new-year-11111100000/" class="post-title">Happy new year 11111100000</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Or, happy new year (2<sup>6−1</sup>)(2<sup>6</sup>−1).</p>

<p>We just wrapped up a long-running big data project.  While I didn&rsquo;t find the
project itself particularly interesting, I learned quite a bit of interesting
stuff doing it.</p>

<p>On the skills side, I learned <a href="https://golang.org">Go</a>,
learned how to navigate AWS,
and gained a good understanding of how cluster data stores work.</p>

<p>But probably the most important takeaway from last year is summarized
neatly in <a href="http://widgetsandshit.com/teddziuba/2010/10/taco-bell-programming.html">this blog post</a> from 2010, recently sent to me by a coworker.
In a nutshell, there are a lot of big data systems that are far
larger and more complicated than they need to be for the data that
they are designed to process.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">02 Jul 2015, 11:14</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2015-07-02-new-blog-engine/" class="post-title">New blog engine</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Trying out <a href="http://gohugo.io/">Hugo</a> as a new blog engine.  If you&rsquo;re reading this, then I&rsquo;ve succeeded.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">27 Jan 2014, 10:07</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2014-01-27-why-you-should-always-understand-whats-going-on-under-the-hood/" class="post-title">Why you should always understand what&#39;s going on under the hood</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        

<p>This is about how I got bitten by <a href="http://datamapper.org/">DataMapper</a>.
No infection and I didn&rsquo;t get rabies, but it still hurt.</p>

<p>I should mention that overall I think DataMapper is pretty good.
It has most of the core features that an ORM should have without unneeded complexity.
It beats the pants off of Active Somethingorother when it comes to making clean, backend-independent models.</p>

<p>Unfortunately <em>most of the core features</em> isn&rsquo;t quite <em>all of the core features</em>, and when you really need that one missing piece, that&rsquo;s when the trouble starts.</p>

<p>What bit me was the combination of two unrelated things:</p>

<ul>
<li>I needed an atomic update with conditions attached.</li>
<li>Datamapper has different representations of the Boolean type, even between different SQLs.</li>
</ul>

<h3 id="the-missing-feature:136baa383e3072f3c5db5b5786002bc4">The Missing Feature</h3>

<p>The glaringly missing feature is the ability to update a value and know
whether or not we actually changed anything.</p>

<p>In SQL this would look like this:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">UPDATE</span> <span style="color: #e6db74">&quot;quarks&quot;</span> <span style="color: #66d9ef">SET</span> <span style="color: #e6db74">&quot;seen&quot;</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;t&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;whosaw&quot;</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;ders&#39;</span> <span style="color: #66d9ef">WHERE</span> <span style="color: #e6db74">&quot;id&quot;</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">42</span> <span style="color: #66d9ef">AND</span> <span style="color: #e6db74">&quot;seen&quot;</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;f&#39;</span>
</pre></div>


<p>Then I would get the number of affected rows to see if a change was made
(i.e. whether or not the quark had already been seen).</p>

<p>So let&rsquo;s try it with DataMapper:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">Quark</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">all(</span><span style="color: #e6db74">:id</span> <span style="color: #f92672">=&gt;</span> <span style="color: #ae81ff">42</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">:seen</span> <span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">false</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">update(</span><span style="color: #e6db74">:seen</span> <span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">true</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">:whosaw</span> <span style="color: #f92672">=&gt;</span> <span style="color: #e6db74">&#39;ders&#39;</span><span style="color: #f8f8f2">)</span>
</pre></div>


<p>Two problems here.
The first problem is that the return value is always true, and we don&rsquo;t
get to see how many rows were updated.
This isn&rsquo;t too big a deal;
we can work around it by using <code>Quark.first</code> instead of <code>Quark.all</code>,
generating an exception if no records are found.</p>

<p>The second problem is the dealbreaker.
Datamapper insists on generating two separate queries for the single
update statement:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">SELECT</span> <span style="color: #e6db74">&quot;id&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;size&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;name&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;seen&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;whosaw&quot;</span> <span style="color: #66d9ef">FROM</span> <span style="color: #e6db74">&quot;quarks&quot;</span> <span style="color: #66d9ef">WHERE</span> <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;id&quot;</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">42</span> <span style="color: #66d9ef">AND</span> <span style="color: #e6db74">&quot;seen&quot;</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;f&#39;</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">ORDER</span> <span style="color: #66d9ef">BY</span> <span style="color: #e6db74">&quot;id&quot;</span>
<span style="color: #66d9ef">UPDATE</span> <span style="color: #e6db74">&quot;quarks&quot;</span> <span style="color: #66d9ef">SET</span> <span style="color: #e6db74">&quot;seen&quot;</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;t&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;whosaw&quot;</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&#39;ders&#39;</span> <span style="color: #66d9ef">WHERE</span> <span style="color: #e6db74">&quot;id&quot;</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">42</span>
</pre></div>
</p>

<p>This obviously won&rsquo;t do, as it&rsquo;s not thread-safe.
Two users running this code at the same time would both believe that they saw the quark first.</p>

<h3 id="the-solution:136baa383e3072f3c5db5b5786002bc4">The Solution</h3>

<p>The solution was to write the update query in SQL.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">da</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">DataMapper</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">repository(</span><span style="color: #e6db74">:default</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">adapter</span>
<span style="color: #f8f8f2">r</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">da</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute(</span><span style="color: #e6db74">&quot;UPDATE quarks SET seen=&#39;t&#39;, whosaw=&#39;ders&#39; WHERE id=42 AND seen=&#39;f&#39;&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">r</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">affected_rows</span> <span style="color: #f92672">&gt;</span> <span style="color: #ae81ff">0</span>
   <span style="color: #f92672">...</span> <span style="color: #75715e"># we saw it first</span>
</pre></div>
</p>

<p>Kind of defeats the purpose of having an ORM, but it gets the job done.
And as it turns out, I&rsquo;m
<a href="http://stackoverflow.com/questions/18650932/how-to-add-a-where-clause-in-update-query-in-datamapper">not the first one</a>
to run into this issue.</p>

<h3 id="how-i-got-bitten:136baa383e3072f3c5db5b5786002bc4">How I Got Bitten</h3>

<p>Little did I know that the internal mapping of a Boolean field varies
between SQL implementations.
For Sqlite and Postgres, it&rsquo;s a character field with <code>'t'</code> and <code>'f'</code> values, whereas for MySQL it&rsquo;s the integers 1 and 0.</p>

<p>In my case the unit tests all passed, but the live server (with a MySQL backend)
started returning 500s.</p>

<p>It&rsquo;s easy enough to change the query to work with MySQL:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">r</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">da</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute(</span><span style="color: #e6db74">&quot;UPDATE quarks SET seen=1, whosaw=&#39;ders&#39; WHERE id=42 AND seen=0&quot;</span><span style="color: #f8f8f2">)</span>
</pre></div>
</p>

<p>But then the unit tests fail.</p>

<p>In the end, I wrote this bit of horrible code to keep the tests passing
and the live server happy.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">t,</span> <span style="color: #f8f8f2">f</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">da</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">options</span><span style="color: #f92672">[</span><span style="color: #e6db74">&#39;scheme&#39;</span><span style="color: #f92672">]</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&#39;sqlite&#39;</span>
  <span style="color: #f92672">[</span><span style="color: #e6db74">&quot;&#39;t&#39;&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;&#39;f&#39;&quot;</span><span style="color: #f92672">]</span> <span style="color: #75715e"># sqlite</span>
<span style="color: #66d9ef">else</span>
  <span style="color: #f92672">[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">]</span> <span style="color: #75715e"># mysql</span>
<span style="color: #66d9ef">end</span>

  <span style="color: #f92672">...</span>

<span style="color: #f8f8f2">r</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">da</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute(</span><span style="color: #e6db74">&quot;UPDATE quarks SET seen=#{</span><span style="color: #f8f8f2">t</span><span style="color: #e6db74">}, whosaw=&#39;ders&#39; WHERE id=42 AND seen=#{</span><span style="color: #f8f8f2">f</span><span style="color: #e6db74">}&quot;</span><span style="color: #f8f8f2">)</span>
</pre></div>
</p>

<p>(There may be a way to extract <code>t</code> and <code>f</code> directly from the
DataMapper internals, but I&rsquo;m not that good yet.)</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">17 Jan 2014, 12:20</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2014-01-17-try-it/" class="post-title">Python</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <div class="highlight" style="background: #272822"><pre style="line-height: 125%">$ python
&gt;&gt;&gt; import this
</pre></div>


<p>Just try it.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">10 Jan 2014, 14:55</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2014-01-10-aws-locale/" class="post-title">AWS Locale</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Every time I start a new EC2 Ubuntu instance, I&rsquo;m confronted with the following
warning when I ssh in:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">_____________________________________________________________________
WARNING! Your environment specifies an invalid locale.
 This can affect your user experience significantly, including the
 ability to manage packages. You may install the locales by running:

   sudo apt-get install language-pack-UTF-8
     or
   sudo locale-gen UTF-8

To see all available language packs, run:
   apt-cache search &quot;^language-pack-[a-z][a-z]$&quot;
To disable this message for all users, run:
   sudo touch /var/lib/cloud/instance/locale-check.skip
_____________________________________________________________________
</pre></div>


<p>Furthermore, a variety of package installations fail with some complaint
related to the locale, the default language, or both.
And for some reason the advice to install relevant language packs
is not helpful.</p>

<p>It turns out that there are some of environment variables
(<code>LANGUAGE</code>, <code>LC_CTYPE</code> and <code>LC_ALL</code> to be specific) that are not
set properly.</p>

<p>The advice to install language packs assumes that these environment
variables are set to a language that&rsquo;s not installed.  However, in the
case of a new EC2 instance, these variables are not set at all.</p>

<p>An easy way to get the warnings to go away is to edit the file
<code>/etc/default/locale</code> so that these variables always get set. I&rsquo;ve found
that the default installation only sets <code>LANG</code>.</p>

<p>/etc/default/locale
<div class="highlight" style="background: #272822"><pre style="line-height: 125%">LANG=en_US.UTF-8
LANGUAGE=en_US
LC_CTYPE=en_US.UTF-8
LC_ALL=en_US.UTF-8
</pre></div>
</p>

<p>As always, it&rsquo;s also a good idea to make sure you have the latest and
greatest packages:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">$ sudo apt-get update
$ sudo apt-get upgrade
</pre></div>
</p>

<p>And finally, while we&rsquo;re at it, why not set the timezone?</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">$ sudo dpkg-reconfigure tzdata
</pre></div>
</p>

<p>Next time I need to set up a new EC2 instance,
I&rsquo;ll come read my own blog and know exactly what to do.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">17 Dec 2013, 11:06</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-12-17-woke-up/" class="post-title">Woke up, fell out of bed</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Things I learned this year:</p>

<p><strong>Ruby.</strong> Ruby is an interesting language, but I find that the ability to
open up classes and modify methods on the fly is too easily abused.
Also not a fan of all the alternate method names (e.g. map and collect) &ndash;
would prefer just to choose one and stick with it.</p>

<p><strong>Git</strong> and <strong>Github.</strong> Made crystal clear with SourceTree.</p>

<p><strong>Rails.</strong> Learned to hate it. Was going to write a blog post on why I
hate rails, but someone
<a href="http://kakubei.blogspot.kr/2012/05/why-i-hate-rails.html">beat me to it</a>.</p>

<p><strong>Rubygems.</strong> Learned to hate them too. I&rsquo;ve wasted a stupid amount of
time figuring out that my program is broken because the gems I&rsquo;m using
don&rsquo;t work the way they&rsquo;re supposed to. Better to just write it myself.
(I actually think the gem system is pretty cool, but quality control,
ladies and gentlemen, quality control.)
And if you can do something in two lines of ruby code, you don&rsquo;t need a gem.</p>

<p><strong>Data Mapper.</strong> I wish this were maintained better. It&rsquo;s a handy tool,
especially when you&rsquo;re dealing with simple, table-friendly data.
It&rsquo;s not so good at complex queries, though, and I think that the lofty goal
of making it compatible with all different kinds of database engines
is hampering its ability to work really well with the most common ones (e.g. SQL).</p>

<p><strong>Python.</strong> Python rocks. My next job will be in a python shop.</p>

<p><strong>Django.</strong> Django rocks along with python. In my next life (when I get
really good at python and am independently wealthy with a lot of free time)
I&rsquo;m going to be a regular contributor to the django project.</p>

<p><strong>Unfuddle</strong> and <strong>Pivotal Tracker.</strong> Say what? What is there to learn there?
In fact there&rsquo;s a lot to learn if you&rsquo;ve never used an issue tracking system before.
I find the Unfuddle UI to be kind of clunky, especially if you&rsquo;re dealing
with a large number of tickets, but it&rsquo;s much more thorough than Pivotal
Tracker in keeping track of comments, ticket disposition, change history,
and so on.
Maybe some clever person will invent a PT-style front end for Unfuddle.</p>

<p><strong>Heroku.</strong> Five stars.
The first time I attempted a heroku deployment, it was all black magic and I was lost.
Now it&rsquo;s still black magic, but I&rsquo;ve learned that I can use it.
Deployment is one of those things that gets more and more complicated the more you try to understand it.
Heroku allows you to remain ignorant and just have your program run.</p>

<p><strong>Android.</strong> On my desktop I have a 2200-page book on how to code for Android.
I&rsquo;m going to tell you I&rsquo;ve read it all. I&rsquo;ll be lying, and you won&rsquo;t believe me.
In reality, I&rsquo;ve learned the basics and can make a simple app.
I&rsquo;m still at the tedious stage where I have to look everything up, and Android programming is already tedious by nature, but I&rsquo;m getting it done.</p>

<p><strong>Amazon AWS.</strong> This probably has the steepest learning curve of all.
The documentation is complete and thorough and is also written to an
audience of Sysadmin Ph.Ds.
So far I&rsquo;ve learned to use S3 buckets and create EC2 instances.</p>

<p>Things I want to learn next year:</p>

<ul>
<li>advanced Python</li>
<li>advanced Django</li>
<li>advanced Git</li>
<li>Neo4j</li>
<li>Go</li>
<li>Sass</li>
<li>node.js</li>
<li>backbone.js</li>
<li>how to deploy stuff (why is this so hard, anyway?)</li>
<li>Haskell</li>
</ul>

                    </div>
                </section>
                
                <h1 class="content-subhead">02 May 2013, 10:03</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-05-02-which-train-is-that/" class="post-title">Which train is that?</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Straight out of college, I went on a summer backpacking trip to Europe.
Well, it wasn&rsquo;t exactly a backpacking trip, as (1) my bag wasn&rsquo;t a backpack, and (2) I actually spent two months in one place attending a language program, but that&rsquo;s another story.</p>

<p>My ticket back home was out of London&rsquo;s Heathrow airport, and since I was in Bavaria at the time, I had a major train + ferry + train journey just to get my flight.
I had the journey carefully researched and perfectly timed so that I&rsquo;d be on the ferry just as my rail pass expired.
The journey, though long, was largely without incident, but something that happened on the tube from Liverpool Street to Heathrow left a lasting impression.</p>

<p>I had figured out in advance which train I needed to catch. I&rsquo;ll guess now that it was the Circle Line to South Kensingon, changing to the Piccadilly Line.
I followed all the signs carefully and got myself to the correct platform.
I noticed that there were other lines operating on the same track, so I had to make sure that I got on the correct train.</p>

<p>Within a couple of minutes, a train arrived.  I looked to see whether or not it was a Circle Line train, but wait.
There was no marking whatsoever.  No Circle Line, no Metropolitan Line, nothing.
And yet, busy Londoners were getting on and off, some were waiting for a different train, and they all obviously knew something about this mystery train that I didn&rsquo;t &ndash;
namely what line it was running.</p>

<p>I finally asked a woman who was standing nearby if she could tell me what train this was.  Predictably, she looked at me as if I were an idiot.
She was silent for a few seconds, and then without moving her head she glanced slightly upward and answered me.  &ldquo;Metropolitan.&rdquo;  End of conversation.</p>

<p>You see, in New York, the line number/letter and destination are clearly visible on the outside of every subway car.
In fact, everywhere I&rsquo;d travelled, every bus, subway, and tram  was labeled in this fasion.
In New York at the time, looking at the train itself was the <em>only</em> way to know if it was the train you wanted; fancy platform displays were as of yet a thing of the future.  It had simply never occurred to me that there was another way.</p>

<p>The train information signs in the London tube station were large enough to read easily but also small enough to miss completely if you didn&rsquo;t know they were there.
Had I gone to London with this one simple bit of information &ndash; that there is train information displayed above the platform &ndash; I could have saved myself this small embarrassment and the possibility of getting on the wrong train.</p>

<p>This, my friends, is an exact parallel of what&rsquo;s happening in my workplace nowadays.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">16 Apr 2013, 14:05</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-04-16-more-data-mapper/" class="post-title">More Data Mapper</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>One of the basic functions of <a href="http://datamapper.org/">Data Mapper</a> is to remember which attributes in the model have been modified so that it&rsquo;s easy to determine what (if anything) needs to be updated in the database.
Data Mapper checks automatically on a call to <a href="http://rubydoc.info/github/datamapper/dm-core/master/DataMapper/Resource#save-instance_method"><code>#save</code></a> and only writes what needs to be written.
It also provides methods <a href="http://rubydoc.info/github/datamapper/dm-core/master/DataMapper/Resource#dirty%3F-instance_method"><code>#dirty?</code></a> and <a href="http://rubydoc.info/github/datamapper/dm-core/master/DataMapper/Resource#attribute_dirty%3F-instance_method"><code>#attribute_dirty?</code></a>, which tell you whether or not a record or a particular attribute has changed.</p>

<p>Unfortunately, while it&rsquo;s easy to find out whether or not an attribute has changed, there is no easy way to see what the old value was.
It&rsquo;s obviously keeping the old value somewhere.  We know this because when you change an attribute back to the old value, it recognizes that you&rsquo;ve done so and considers it unchanged.</p>

<p>There is a method called <a href="http://rubydoc.info/github/datamapper/dm-core/master/DataMapper/Resource#dirty_attributes-instance_method"><code>#dirty_attributes</code></a>, which returns a hash of changed attributes, but the keys to this hash are hashes themselves and in a format that&rsquo;s used only internally in Data Mapper, making it a needlessly inconvenient method to use.
Also, I&rsquo;d like to avoid <code>#dirty_attributes</code> as it&rsquo;s not part of the public API.</p>

<p>There is a possible workaround, suggested by some.  Override the setter for the attribute and save the old value for later use.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">thing</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">(newthing)</span>
  <span style="color: #f8f8f2">@oldthing</span> <span style="color: #f92672">||=</span> <span style="color: #f8f8f2">@thing</span>
  <span style="color: #f8f8f2">@thing</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">newthing</span>
<span style="color: #66d9ef">end</span>
</pre></div>


<p>I&rsquo;m not going to link to the people who suggested this, though, because it&rsquo;s a terrible suggestion.  Since we&rsquo;ve overridden Data Mapper&rsquo;s setter for attribute <code>thing</code>, Data Mapper no longer knows that we&rsquo;ve changed its value.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">001</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">Record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #f92672">...</span>
<span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">002</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">thing</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #e6db74">&quot;teamaker&quot;</span>
<span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">003</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">thing</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;coffeemaker&quot;</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #e6db74">&quot;coffeemaker&quot;</span>
<span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">004</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">attribute_dirty?(</span><span style="color: #e6db74">:thing</span><span style="color: #f8f8f2">)</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">false</span>
</pre></div>


<p>Imagine the insidious bugs that could creep in here.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">005</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">save</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">true</span>
<span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">006</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">Record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #f92672">...</span>
<span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">003</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">thing</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #e6db74">&quot;teamaker&quot;</span>
</pre></div>
</p>

<p>Simply put, our changes are silently ignored because we&rsquo;ve stupidly disabled what is arguably Data Mapper&rsquo;s most important function.</p>

<p>Fortunately, there is a correct way to do this.  Instead of setting the attributes directly, we set them using Data Mapper&rsquo;s <a href="http://rubydoc.info/github/datamapper/dm-core/master/DataMapper/Resource#attribute_set-instance_method"><code>#attribute_set</code></a>.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">thing</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">(newthing)</span>
  <span style="color: #f8f8f2">@oldthing</span> <span style="color: #f92672">||=</span> <span style="color: #f8f8f2">@thing</span>
  <span style="color: #f8f8f2">attribute_set(</span><span style="color: #e6db74">:thing</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">newthing)</span>
<span style="color: #66d9ef">end</span>
</pre></div>
</p>

<p>Method <code>#attribute_set</code> keeps track of the changes.  It&rsquo;s what <code>thing=</code> pointed to before we overrode it.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">16 Apr 2013, 12:19</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-04-16-data-mapper/" class="post-title">Data Mapper</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>I&rsquo;ve been working on a project with <a href="http://www.padrinorb.com/">Padrino</a> and <a href="http://datamapper.org">Data Mapper</a>.
So far I&rsquo;m quite a fan of the Data Mapper way of doing things.</p>

<p>Unfortunately, I&rsquo;m schooled in the old way &ndash; ugly messes of <code>SELECT</code>, <code>JOIN</code> and <code>ORDER BY</code>,
intelligible only by SQL gurus and dependent not just on SQL but on a particular variety of such, which in my case would be MySQL.</p>

<p>I label this as unfortunate because my concept of database (e.g. MySQL) heavily influences how I organize the code I write.
I often find myself with a &ldquo;How do you do this in DataMapper?&rdquo; kind of question, where <em>this</em> is something that I know how to do the old way.
After all, DataMapper is generating SQL queries from the models I write, so if it&rsquo;s easy in SQL, shouldn&rsquo;t it also be easy in DataMapper?</p>

<p>(Side note: DataMapper doesn&rsquo;t <em>necessarily</em> generate SQL, but in my current project the backend is SQL and I see the generated queries on the debugging console.)</p>

<p>Recently I&rsquo;ve a question of this sort that I haven&rsquo;t been able to solve.</p>

<p>I have a model with an ordering field, which we&rsquo;ll call <code>position</code>.  I want to sort by this field (ascending), except that I want all the zeroes to be at the end.  In addition, I&rsquo;d like the all the records with <code>position=0</code> sorted by <code>id</code> descending.</p>

<p>In MySQL, I would write:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">SELECT</span> <span style="color: #f92672">*</span> <span style="color: #66d9ef">FROM</span> <span style="color: #f92672">`</span><span style="color: #f8f8f2">things</span><span style="color: #f92672">`</span> <span style="color: #66d9ef">ORDER</span> <span style="color: #66d9ef">BY</span> <span style="color: #f92672">`</span><span style="color: #66d9ef">position</span><span style="color: #f92672">`=</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #f92672">`</span><span style="color: #66d9ef">position</span><span style="color: #f92672">`</span><span style="color: #f8f8f2">,</span> <span style="color: #f92672">`</span><span style="color: #f8f8f2">id</span><span style="color: #f92672">`</span> <span style="color: #66d9ef">DESC</span>
</pre></div>


<p>Free donuts to the first person who can make a DataMapper version of this.</p>

                    </div>
                </section>
                
            </div>
            
<div class="pagination">
  <nav role="pagination" class="post-list-pagination">
      
    <span class="post-list-pagination-item post-list-pagination-item-current">Page 1 of 2</span>
    
      <a href="https://ders.github.io/page/2/" class="post-list-pagination-item pure-button post-list-pagination-item-next">
        Older&nbsp;<i class="fa fa-angle-double-right"></i>
      </a>
    
  </nav>
</div>


            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="http://hugo.spf13.com/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="https://ders.github.io/js/all.min.js"></script>
        </div>
    </div>
</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
