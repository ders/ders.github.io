<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts &middot; awm&#39;s blog</title>

    <meta name="description" content="What did I do today?">

    <meta name="generator" content="Hugo 0.15" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="Posts &middot; awm&#39;s blog">
    <meta name="twitter:description" content="What did I do today?">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Posts &middot; awm&#39;s blog">
    <meta property="og:description" content="What did I do today?">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
    <!--<![endif]-->

    <link rel="stylesheet" href="https://ders.github.io/css/all.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://ders.github.io/css/vim.css">

    <link rel="alternate" type="application/rss+xml" title="awm&#39;s blog" href="https://ders.github.io/index.xml" />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://ders.github.io">awm&#39;s blog</a></h1>
            <h2 class="brand-tagline"> What did I do today? </h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                
                <li class="nav-item">
                    <a class="pure-button" href="https://ders.github.io/index.xml"><i class="fa fa-rss"></i> rss</a>
                </li>
            </ul>
        </nav>
    </div>
</div>

    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                
                <h1 class="content-subhead">02 May 2013, 10:03</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-05-02-which-train-is-that/" class="post-title">Which train is that?</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Straight out of college, I went on a summer backpacking trip to Europe.
Well, it wasn&rsquo;t exactly a backpacking trip, as (1) my bag wasn&rsquo;t a backpack, and (2) I actually spent two months in one place attending a language program, but that&rsquo;s another story.</p>

<p>My ticket back home was out of London&rsquo;s Heathrow airport, and since I was in Bavaria at the time, I had a major train + ferry + train journey just to get my flight.
I had the journey carefully researched and perfectly timed so that I&rsquo;d be on the ferry just as my rail pass expired.
The journey, though long, was largely without incident, but something that happened on the tube from Liverpool Street to Heathrow left a lasting impression.</p>

<p>I had figured out in advance which train I needed to catch. I&rsquo;ll guess now that it was the Circle Line to South Kensingon, changing to the Piccadilly Line.
I followed all the signs carefully and got myself to the correct platform.
I noticed that there were other lines operating on the same track, so I had to make sure that I got on the correct train.</p>

<p>Within a couple of minutes, a train arrived.  I looked to see whether or not it was a Circle Line train, but wait.
There was no marking whatsoever.  No Circle Line, no Metropolitan Line, nothing.
And yet, busy Londoners were getting on and off, some were waiting for a different train, and they all obviously knew something about this mystery train that I didn&rsquo;t &ndash;
namely what line it was running.</p>

<p>I finally asked a woman who was standing nearby if she could tell me what train this was.  Predictably, she looked at me as if I were an idiot.
She was silent for a few seconds, and then without moving her head she glanced slightly upward and answered me.  &ldquo;Metropolitan.&rdquo;  End of conversation.</p>

<p>You see, in New York, the line number/letter and destination are clearly visible on the outside of every subway car.
In fact, everywhere I&rsquo;d travelled, every bus, subway, and tram  was labeled in this fasion.
In New York at the time, looking at the train itself was the <em>only</em> way to know if it was the train you wanted; fancy platform displays were as of yet a thing of the future.  It had simply never occurred to me that there was another way.</p>

<p>The train information signs in the London tube station were large enough to read easily but also small enough to miss completely if you didn&rsquo;t know they were there.
Had I gone to London with this one simple bit of information &ndash; that there is train information displayed above the platform &ndash; I could have saved myself this small embarrassment and the possibility of getting on the wrong train.</p>

<p>This, my friends, is an exact parallel of what&rsquo;s happening in my workplace nowadays.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">16 Apr 2013, 14:05</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-04-16-more-data-mapper/" class="post-title">More Data Mapper</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>One of the basic functions of <a href="http://datamapper.org/">Data Mapper</a> is to remember which attributes in the model have been modified so that it&rsquo;s easy to determine what (if anything) needs to be updated in the database.
Data Mapper checks automatically on a call to <a href="http://rubydoc.info/github/datamapper/dm-core/master/DataMapper/Resource#save-instance_method"><code>#save</code></a> and only writes what needs to be written.
It also provides methods <a href="http://rubydoc.info/github/datamapper/dm-core/master/DataMapper/Resource#dirty%3F-instance_method"><code>#dirty?</code></a> and <a href="http://rubydoc.info/github/datamapper/dm-core/master/DataMapper/Resource#attribute_dirty%3F-instance_method"><code>#attribute_dirty?</code></a>, which tell you whether or not a record or a particular attribute has changed.</p>

<p>Unfortunately, while it&rsquo;s easy to find out whether or not an attribute has changed, there is no easy way to see what the old value was.
It&rsquo;s obviously keeping the old value somewhere.  We know this because when you change an attribute back to the old value, it recognizes that you&rsquo;ve done so and considers it unchanged.</p>

<p>There is a method called <a href="http://rubydoc.info/github/datamapper/dm-core/master/DataMapper/Resource#dirty_attributes-instance_method"><code>#dirty_attributes</code></a>, which returns a hash of changed attributes, but the keys to this hash are hashes themselves and in a format that&rsquo;s used only internally in Data Mapper, making it a needlessly inconvenient method to use.
Also, I&rsquo;d like to avoid <code>#dirty_attributes</code> as it&rsquo;s not part of the public API.</p>

<p>There is a possible workaround, suggested by some.  Override the setter for the attribute and save the old value for later use.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">thing</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">(newthing)</span>
  <span style="color: #f8f8f2">@oldthing</span> <span style="color: #f92672">||=</span> <span style="color: #f8f8f2">@thing</span>
  <span style="color: #f8f8f2">@thing</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">newthing</span>
<span style="color: #66d9ef">end</span>
</pre></div>


<p>I&rsquo;m not going to link to the people who suggested this, though, because it&rsquo;s a terrible suggestion.  Since we&rsquo;ve overridden Data Mapper&rsquo;s setter for attribute <code>thing</code>, Data Mapper no longer knows that we&rsquo;ve changed its value.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">001</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">Record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #f92672">...</span>
<span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">002</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">thing</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #e6db74">&quot;teamaker&quot;</span>
<span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">003</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">thing</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;coffeemaker&quot;</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #e6db74">&quot;coffeemaker&quot;</span>
<span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">004</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">attribute_dirty?(</span><span style="color: #e6db74">:thing</span><span style="color: #f8f8f2">)</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">false</span>
</pre></div>


<p>Imagine the insidious bugs that could creep in here.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">005</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">save</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">true</span>
<span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">006</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">Record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">get(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2">)</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #f92672">...</span>
<span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">003</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">record</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">thing</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #e6db74">&quot;teamaker&quot;</span>
</pre></div>
</p>

<p>Simply put, our changes are silently ignored because we&rsquo;ve stupidly disabled what is arguably Data Mapper&rsquo;s most important function.</p>

<p>Fortunately, there is a correct way to do this.  Instead of setting the attributes directly, we set them using Data Mapper&rsquo;s <a href="http://rubydoc.info/github/datamapper/dm-core/master/DataMapper/Resource#attribute_set-instance_method"><code>#attribute_set</code></a>.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">thing</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">(newthing)</span>
  <span style="color: #f8f8f2">@oldthing</span> <span style="color: #f92672">||=</span> <span style="color: #f8f8f2">@thing</span>
  <span style="color: #f8f8f2">attribute_set(</span><span style="color: #e6db74">:thing</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">newthing)</span>
<span style="color: #66d9ef">end</span>
</pre></div>
</p>

<p>Method <code>#attribute_set</code> keeps track of the changes.  It&rsquo;s what <code>thing=</code> pointed to before we overrode it.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">16 Apr 2013, 12:19</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-04-16-data-mapper/" class="post-title">Data Mapper</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>I&rsquo;ve been working on a project with <a href="http://www.padrinorb.com/">Padrino</a> and <a href="http://datamapper.org">Data Mapper</a>.
So far I&rsquo;m quite a fan of the Data Mapper way of doing things.</p>

<p>Unfortunately, I&rsquo;m schooled in the old way &ndash; ugly messes of <code>SELECT</code>, <code>JOIN</code> and <code>ORDER BY</code>,
intelligible only by SQL gurus and dependent not just on SQL but on a particular variety of such, which in my case would be MySQL.</p>

<p>I label this as unfortunate because my concept of database (e.g. MySQL) heavily influences how I organize the code I write.
I often find myself with a &ldquo;How do you do this in DataMapper?&rdquo; kind of question, where <em>this</em> is something that I know how to do the old way.
After all, DataMapper is generating SQL queries from the models I write, so if it&rsquo;s easy in SQL, shouldn&rsquo;t it also be easy in DataMapper?</p>

<p>(Side note: DataMapper doesn&rsquo;t <em>necessarily</em> generate SQL, but in my current project the backend is SQL and I see the generated queries on the debugging console.)</p>

<p>Recently I&rsquo;ve a question of this sort that I haven&rsquo;t been able to solve.</p>

<p>I have a model with an ordering field, which we&rsquo;ll call <code>position</code>.  I want to sort by this field (ascending), except that I want all the zeroes to be at the end.  In addition, I&rsquo;d like the all the records with <code>position=0</code> sorted by <code>id</code> descending.</p>

<p>In MySQL, I would write:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">SELECT</span> <span style="color: #f92672">*</span> <span style="color: #66d9ef">FROM</span> <span style="color: #f92672">`</span><span style="color: #f8f8f2">things</span><span style="color: #f92672">`</span> <span style="color: #66d9ef">ORDER</span> <span style="color: #66d9ef">BY</span> <span style="color: #f92672">`</span><span style="color: #66d9ef">position</span><span style="color: #f92672">`=</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">,</span> <span style="color: #f92672">`</span><span style="color: #66d9ef">position</span><span style="color: #f92672">`</span><span style="color: #f8f8f2">,</span> <span style="color: #f92672">`</span><span style="color: #f8f8f2">id</span><span style="color: #f92672">`</span> <span style="color: #66d9ef">DESC</span>
</pre></div>


<p>Free donuts to the first person who can make a DataMapper version of this.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">21 Mar 2013, 12:19</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-03-21-rails-for-zombies/" class="post-title">Rails for Zombies</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>I got introduced today to <a href="http://railsforzombies.org">an excellent Ruby on Rails tutorial</a> with an entertaining zombie theme.  It covered a lot of the basic concepts, many of which I&rsquo;d skipped over in my haste to dive into a real-live project.</p>

<p>Being who I am, I noticed a couple of inconsistencies between the tutorial videos and the exercises.  Actually, this only applies to the level 5 video; the rest seemed to be fine.</p>

<p>In the level 5 video at 2:10, the following match example is given:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">match</span> <span style="color: #e6db74">&#39;new_tweet&#39;</span> <span style="color: #f92672">=&gt;</span> <span style="color: #e6db74">&quot;Tweets#new&quot;</span>
</pre></div>


<p>Note the uppercase T on Tweets.  This T is uppercase throughout the video.</p>

<p>However, when I tried to do the second exercise for this level, the following answer was rejected:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">match</span> <span style="color: #e6db74">&#39;undead&#39;</span> <span style="color: #f92672">=&gt;</span> <span style="color: #e6db74">&quot;Zombies#undead&quot;</span>
</pre></div>


<p>The hints told me to do this:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">match</span> <span style="color: #e6db74">&#39;undead&#39;</span> <span style="color: #f92672">=&gt;</span> <span style="color: #e6db74">&quot;zombies#undead&quot;</span>
</pre></div>


<p>with a lower case z, which was accepted.  Now I&rsquo;m confused.  Do we need a capital letter here or not?</p>

<p>In the same video at 3:30, the following match example is given:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">match</span> <span style="color: #e6db74">&#39;all&#39;</span> <span style="color: #f92672">=&gt;</span> <span style="color: #f8f8f2">redirect(</span><span style="color: #e6db74">&#39;/tweets&#39;</span><span style="color: #f8f8f2">)</span>
</pre></div>
</p>

<p>Note that there is no leading slash on &lsquo;all&rsquo;; this format is consistent throughout the video.</p>

<p>However, when I tried to do the third exercise, the following answer was rejected:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">match</span> <span style="color: #e6db74">&#39;undead&#39;</span> <span style="color: #f92672">=&gt;</span> <span style="color: #f8f8f2">redirect(</span><span style="color: #e6db74">&#39;/zombies&#39;</span><span style="color: #f8f8f2">)</span>
</pre></div>
</p>

<p>This time the hints told me to do this:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">match</span> <span style="color: #e6db74">&#39;/undead&#39;</span> <span style="color: #f92672">=&gt;</span> <span style="color: #f8f8f2">redirect(</span><span style="color: #e6db74">&#39;/zombies&#39;</span><span style="color: #f8f8f2">)</span>
</pre></div>
</p>

<p>Again, I&rsquo;m confused. Do we need (or even want) a leading slash here?</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">15 Mar 2013, 16:59</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-03-15-good-tools/" class="post-title">Good Tools</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        

<p>Here are some some tools that I like.</p>

<h2 id="rerun:641fb2fef50bdd606c86780f8eb06737">Rerun</h2>

<blockquote>
<p>Rerun launches your program, then watches the filesystem. If a relevant file changes, then it restarts your program.</p>
</blockquote>

<p>I had some trouble getting Shotgun configured probably, and I found <a href="https://github.com/alexch/rerun">Rerun</a> to be a simple alternative.  I like it because it can be used for any process you want, not just restarting your web server.</p>

<h2 id="gitk:641fb2fef50bdd606c86780f8eb06737">Gitk</h2>

<p><a href="http://gitk.sourceforge.net/">Gitk</a> is a graphical interface for Git.  It shows your entire development tree graphically, great for those of us less fluent in pushes and pulls.  It does a lot of other things too that I don&rsquo;t know about.</p>

<p>Debian-based systems can enjoy Gitk with a simple <code>sudo apt-get install gitk</code>.  Then issue a <code>gitk --all</code> to see everything.</p>

<h2 id="irb:641fb2fef50bdd606c86780f8eb06737">Irb</h2>

<p><a href="http://ruby-doc.org/docs/ProgrammingRuby/html/irb.html">Irb</a> is the Ruby console.  I should actually generalize this and include all consoles.  One of the most valuable checks while coding is to paste snippets of code into the console and see that they do what you think they&rsquo;re doing.</p>

<p>Make an <code>.irbrc</code> startup file for a richer experience.  Rails users can get a the console with the full Rails evnironment with <code>rails c</code>.</p>

<p>Here is <a href="http://samuelmullen.com/2012/07/getting-more-out-of-the-rails-console/">an excellent blog post</a> on the topic.</p>

<h2 id="awesome-print:641fb2fef50bdd606c86780f8eb06737">Awesome Print</h2>

<p>A great companion to the Ruby console is <a href="https://github.com/michaeldv/awesome_print">Awesome Print</a>, a Ruby gem which lets you pretty up the output of array, hashes, and the like while in the console.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">001</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">{</span><span style="color: #e6db74">:name</span> <span style="color: #f92672">=&gt;</span> <span style="color: #e6db74">&quot;Hong Gildong&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">:age</span> <span style="color: #f92672">=&gt;</span> <span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">:interests</span> <span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">nil</span><span style="color: #f8f8f2">}</span>
 <span style="color: #f92672">=&gt;</span> <span style="color: #f8f8f2">{</span><span style="color: #e6db74">:name</span><span style="color: #f92672">=&gt;</span><span style="color: #e6db74">&quot;Hong Gildong&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">:age</span><span style="color: #f92672">=&gt;</span><span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">:interests</span><span style="color: #f92672">=&gt;</span><span style="color: #66d9ef">nil</span><span style="color: #f8f8f2">}</span>
<span style="color: #ae81ff">1</span><span style="color: #f92672">.</span><span style="color: #ae81ff">9</span><span style="color: #f92672">.</span><span style="color: #ae81ff">3</span><span style="color: #f92672">-</span><span style="color: #f8f8f2">p392</span> <span style="color: #f8f8f2">:</span><span style="color: #ae81ff">002</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">ap</span> <span style="color: #f8f8f2">_</span>
<span style="color: #f8f8f2">{</span>
         <span style="color: #e6db74">:name</span> <span style="color: #f92672">=&gt;</span> <span style="color: #e6db74">&quot;Hong Gildong&quot;</span><span style="color: #f8f8f2">,</span>
          <span style="color: #e6db74">:age</span> <span style="color: #f92672">=&gt;</span> <span style="color: #ae81ff">10</span><span style="color: #f8f8f2">,</span>
    <span style="color: #e6db74">:interests</span> <span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">nil</span>
<span style="color: #f8f8f2">}</span>
</pre></div>


<h2 id="sass:641fb2fef50bdd606c86780f8eb06737">Sass</h2>

<blockquote>
<p>Sass makes css fun again.</p>
</blockquote>

<p><a href="http://sass-lang.com/">Sass</a> is a nifty program that adds some badly-needed css functionality, such as variables, nesting and inheritance.  But the really nifty thing is how it&rsquo;s accomplished.</p>

<p>You make a <code>.scss</code> file and Sass converts it to an equivalent <code>.css</code> that any browser, even IE, can understand.  Sass even has a stealth mode, where it will regenerate the css when your scss is updated.</p>

<p>Sass is packaged as a Ruby gem, but you&rsquo;re not limited to using it on Ruby projects, since in the end all you need on your server (obviously) are the css files it generates locally.</p>

<p>It&rsquo;s likely that a lot of Sass&rsquo;s functionality will eventually become standard css.  But for now, we&rsquo;ve got Sass.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">26 Feb 2013, 15:57</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-02-26-validataing-data-with-mongoid/" class="post-title">Validating data with Mongoid</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>I&rsquo;ve been working with <a href="http://mongoid.org/en/mongoid/">Mongoid</a>, which is an object-document-mapper for <a href="http://mongodb.org/">MongoDB</a> written in Ruby.</p>

<p>Mongo organizes data into collections of documents, just as relational databases such as SQL organize data into tables of records.  Reading and writing of
documents is done via named classes, one for each collection.</p>

<p>The named class for each collection includes <code>Mongoid::Document</code> to get the database interface methods such as <code>.where</code>, <code>.new</code>, and <code>.save</code>. It also defines the data fields and any custom data handlers.</p>

<p>One very useful feature is the availability of automatic validators which check the format and integrity of your data before allowing it to be saved.  There&rsquo;s a myriad of options, and they are <a href="http://mongoid.org/en/mongoid/docs/validation.html">not very well explained</a> in the documentation.</p>

<p>Since the data validators are shared with <a href="http://api.rubyonrails.org/classes/ActiveModel.html">Active Model</a>, I decided to look for some help there and found <a href="http://apidock.com/rails/ActiveModel/Validations/ClassMethods/validates">this pretty good description</a> of what kind of validation could be done.
Unfortunately, it wasn&rsquo;t clear anywhere how to actually use the validators once they&rsquo;re defined.</p>

<p>After a bit of hair-pulling, I discovered it&rsquo;s actually quite simple.</p>

<p>Let&rsquo;s define a minimal class <code>Iqscore</code>.  (The name of the collection will be <code>iqscores</code>; this is a weird behavior of Mongoid whereby class names must be singular and Mongoid will pluralize them for you when naming the collection.)</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f8f8f2">require</span> <span style="color: #e6db74">&quot;mongoid&quot;</span>

<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">Iqscore</span>

  <span style="color: #66d9ef">include</span> <span style="color: #66d9ef">Mongoid</span><span style="color: #f92672">::</span><span style="color: #66d9ef">Document</span>

  <span style="color: #f8f8f2">field</span> <span style="color: #e6db74">:kid</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">:type</span> <span style="color: #f92672">=&gt;</span> <span style="color: #f8f8f2">String</span>
  <span style="color: #f8f8f2">field</span> <span style="color: #e6db74">:iq</span><span style="color: #f8f8f2">,</span>  <span style="color: #e6db74">:type</span> <span style="color: #f92672">=&gt;</span> <span style="color: #f8f8f2">Integer</span>

  <span style="color: #f8f8f2">validates</span> <span style="color: #e6db74">:kid</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">:presence</span> <span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">true</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">:uniqueness</span> <span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">true</span>
  <span style="color: #f8f8f2">validates</span> <span style="color: #e6db74">:iq</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">:numericality</span> <span style="color: #f92672">=&gt;</span> <span style="color: #66d9ef">true</span>

<span style="color: #66d9ef">end</span>
</pre></div>


<p>Mongoid provides a <code>valid?</code> method on Iqscore objects.  Valid? tells us whether or not the criteria in the <code>validates</code> declarations are met.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">1.9.3p385 :008 &gt; x = Iqscore.new({kid: &quot;George&quot;, iq: 70})
 =&gt; #&lt;Iqscore _id: 512c72d5352420234d000003, kid: &quot;George&quot;, iq: 70&gt;
1.9.3p385 :009 &gt; x.valid?
 =&gt; true
</pre></div>
</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">1.9.3p385 :010 &gt; y = Iqscore.new({kid: &quot;Bill&quot;, iq: &quot;unknown&quot;})
 =&gt; #&lt;Iqscore _id: 512c736e352420234d000004, kid: &quot;Bill&quot;, iq: 0&gt;
1.9.3p385 :011 &gt; y.valid?
 =&gt; false
</pre></div>
</p>

<p>If it doesn&rsquo;t validate, we can see what&rsquo;s wrong by looking at the <code>errors</code> property.  In this case it tells us that <code>iq</code> is not a number (and it should be).  Note that the message &ldquo;is not a number&rdquo; is in an array, as it&rsquo;s possible for there to be multiple messages for a single field.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">1.9.3p385 :012 &gt; y.errors
 =&gt; #&lt;ActiveModel::Errors:0x98a31cc @base=#&lt;Iqscore _id: 512c736e352420234d000004, kid: &quot;Bill&quot;, iq: 0&gt;, @messages={:iq=&gt;[&quot;is not a number&quot;]}&gt;
</pre></div>
</p>

<p>The <code>valid?</code> method is called automatically before any save operation (e.g. <code>save</code> or <code>create</code>), and if it returns false, then the save is not done.  Both <code>save</code> and <code>create</code> return true or false to indicate whether the save was done or not.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">1.9.3p385 :013 &gt; x.save
 =&gt; true
1.9.3p385 :014 &gt; y.save
 =&gt; false
</pre></div>
</p>

<p>At this point George is in our database, but Bill isn&rsquo;t.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">22 Feb 2013, 18:20</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-02-22-power/" class="post-title">Power</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Finished a user athentication system today using <a href="http://bcrypt-ruby.rubyforge.org/classes/BCrypt/Password.html">BCrypt::Password</a>.</p>

<p>There was an Aha! moment when I realized that they&rsquo;ve defined the <code>==</code> operator to return true when the password matches, not when the strings are equal (as a novice like me might expect).</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">1.9.3p385 :002 &gt; secret = BCrypt::Password.create(&quot;password&quot;)
 =&gt; &quot;$2a$10$50UZDPv124TYHe4xwQLoBeuryd0lzcCkjVdepHQD41K9svNE7lXGe&quot;
</pre></div>


<p>The hashed secret is saved in the database.&nbsp; It&rsquo;s later retrieved and checked against the user input using <code>==</code>.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">1.9.3p385 :005 &gt; secret
 =&gt; &quot;$2a$10$50UZDPv124TYHe4xwQLoBeuryd0lzcCkjVdepHQD41K9svNE7lXGe&quot;
1.9.3p385 :006 &gt; q = BCrypt::Password.new(secret)
 =&gt; &quot;$2a$10$50UZDPv124TYHe4xwQLoBeuryd0lzcCkjVdepHQD41K9svNE7lXGe&quot;
1.9.3p385 :007 &gt; q == &quot;password&quot;
 =&gt; true
</pre></div>


<p>This also has the interesting side effect that <code>==</code> is not commutative.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%">1.9.3p385 :008 &gt; &quot;password&quot; == q
 =&gt; false
</pre></div>
</p>

<p>My junior high math teacher would be disturbed by this.&nbsp; Such is the power of Ruby.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">22 Feb 2013, 10:41</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-02-22-tip-of-the-day/" class="post-title">Tip of the day</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>When running the Mongo shell for the first time, it is necessary to specify the port:</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%">$ mongo 127.0.0.1:27017
</pre></div>


<p>Subsequently it is sufficient just to to say <code>mongo</code>.</p>

<p>Learned the hard way, and by reading <a href="http://stackoverflow.com/a/8509918">this answer</a>.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">20 Feb 2013, 10:58</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-02-20-the-rubymonk-tutorial/" class="post-title">The RubyMonk Tutorial</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>I&rsquo;ve been working my way through the <a href="http://rubymonk.com/learning/books">RubyMonk Tutorials</a>.
They are very well written and do an excellent job of guiding the user through progressively harder concepts.</p>

<p>Today I found a couple of careless coding errors in the <a href="http://rubymonk.com/learning/books/4/chapters/44-collections/lessons/98-iterate-filtrate-and-transform">section on using Array#inject</a> (subscription required).  The first is an illustration of inject to do a simple sum of array elements.</p>

<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">[</span><span style="color: #ae81ff">4</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">15</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">16</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">23</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">42</span><span style="color: #f92672">].</span><span style="color: #f8f8f2">inject(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">do</span> <span style="color: #f92672">|</span><span style="color: #f8f8f2">accumulator,</span> <span style="color: #f8f8f2">iterated</span><span style="color: #f92672">|</span>
  <span style="color: #f8f8f2">accumulator</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">iterated</span>
  <span style="color: #f8f8f2">accumulator</span>
<span style="color: #66d9ef">end</span>
</pre></div>


<p>In fact, the assignment statement here is superfluous, as the inject
function assigns the return value of the block to the accumulator automatically.
It would suffice to do:</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #f92672">[</span><span style="color: #ae81ff">4</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">15</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">16</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">23</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">42</span><span style="color: #f92672">].</span><span style="color: #f8f8f2">inject(</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">do</span> <span style="color: #f92672">|</span><span style="color: #f8f8f2">accumulator,</span> <span style="color: #f8f8f2">iterated</span><span style="color: #f92672">|</span>
  <span style="color: #f8f8f2">accumulator</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">iterated</span>
<span style="color: #66d9ef">end</span>
</pre></div>
</p>

<p>The second error is in an illustration of the behavior of inject.
The function below is supposed to mimic the behavior of the one above.</p>

<p><div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span style="color: #66d9ef">def</span> <span style="color: #a6e22e">custom_inject</span><span style="color: #f8f8f2">(array,</span> <span style="color: #f8f8f2">default</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">nil</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">accumulator</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">default</span> <span style="color: #f92672">||</span> <span style="color: #f8f8f2">array</span><span style="color: #f92672">[</span><span style="color: #ae81ff">0</span><span style="color: #f92672">]</span>

  <span style="color: #f8f8f2">array</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">each</span> <span style="color: #66d9ef">do</span> <span style="color: #f92672">|</span><span style="color: #f8f8f2">element</span><span style="color: #f92672">|</span>
    <span style="color: #f8f8f2">accumulator</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">accumulator</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">element</span>
  <span style="color: #66d9ef">end</span>

  <span style="color: #f8f8f2">accumulator</span>
<span style="color: #66d9ef">end</span>

<span style="color: #f8f8f2">p</span> <span style="color: #f8f8f2">custom_inject(</span><span style="color: #f92672">[</span><span style="color: #ae81ff">4</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">15</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">16</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">23</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">42</span><span style="color: #f92672">]</span><span style="color: #f8f8f2">,</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2">)</span>
</pre></div>
</p>

<p>The <code>custom_inject</code> function, however, fails for the case where the default value is not given.  It fails by counting the first array element twice.</p>

<p>Native inject begins iterating from the second array element, as the first element has already been used as the starting value.</p>

                    </div>
                </section>
                
                <h1 class="content-subhead">18 Feb 2013, 17:18</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://ders.github.io/post/2013-02-18-hi-there/" class="post-title">Hi there.</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>

                    <div class="post-description">
                        <p>Day one.</p>

<p>Got a new blog, and I&rsquo;ve learned some Ruby basics on <a href="http://rubymonk.com">Rubymonk</a>.  Also got a helluva cold and pine for the bed.</p>

                    </div>
                </section>
                
            </div>
            
<div class="pagination">
  <nav role="pagination" class="post-list-pagination">
      
      <a href="https://ders.github.io/post/" class="post-list-pagination-item pure-button post-list-pagination-item-prev">
        <i class="fa fa-angle-double-left"></i>&nbsp;Newer
      </a>
      
    <span class="post-list-pagination-item post-list-pagination-item-current">Page 2 of 2</span>
    
  </nav>
</div>


            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="http://hugo.spf13.com/" target="_blank">hugo</a></li>
        </ul>
    </div>
</div>
<script src="https://ders.github.io/js/all.min.js"></script>
        </div>
    </div>
</div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
